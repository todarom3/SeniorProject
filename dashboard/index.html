<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Fraud Dashboard (Basic)</title>
</head>
<body>
  <h1>Fraud Dashboard (Walking Skeleton)</h1>

  <!-- Shows the “fraud detection dashboard” info -->
  <p><b>Total transactions:</b> <span id="total">Loading…</span></p>
  <p><b>Fraud flagged:</b> <span id="fraud">Loading…</span></p>

  <!-- display the CSV rows -->
  <table border="1" cellpadding="6" cellspacing="0">
    <thead>
      <tr>
        <th>transaction_id</th>
        <th>timestamp</th>
        <th>merchant</th>
        <th>location</th>
        <th>amount</th>
        <th>is_fraud</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="6">Loading…</td></tr>
    </tbody>
  </table>

  <script>
    // This dashboard reads John's CSV file and displays it.
const CSV_PATH = "../FakeTransactionGenerator/transactions.csv";

    // CSV parser (splits lines by \n and columns by comma).
    function parseCSV(text) {
      const lines = text.trim().split("\n");
      const header = lines[0].split(",");

      const data = [];
      for (let i = 1; i < lines.length; i++) {
        const cols = lines[i].split(",");
        data.push(cols);
      }
      return data;
    }

    async function load() {
      // 1) Download the CSV file
      const res = await fetch(CSV_PATH);
      const text = await res.text();

      // 2) Parse it
      const rows = parseCSV(text);

      // 3) Compute basic metrics
      const total = rows.length;
      const fraudCount = rows.filter(r => String(r[6]).trim() === "1" || String(r[6]).trim().toLowerCase() === "true").length;

      document.getElementById("total").textContent = total;
      document.getElementById("fraud").textContent = fraudCount;

      // 4) Show rows in the table
      const tbody = document.getElementById("rows");
      tbody.innerHTML = "";

      rows.slice(0, 100).forEach(r => {
        const tr = document.createElement("tr");

        // 0 transaction_id, 1 card_number, 2 timestamp, 3 merchant, 4 location, 5 amount, 6 is_fraud
        tr.innerHTML = `
          <td>${r[0]}</td>
          <td>${r[2]}</td>
          <td>${r[3]}</td>
          <td>${r[4]}</td>
          <td>${r[5]}</td>
          <td>${r[6]}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    load().catch(err => {
      console.error(err);
      document.getElementById("rows").innerHTML =
        `<tr><td colspan="6">Failed to load CSV. If you're opening this file locally, use GitHub Pages instead.</td></tr>`;
    });
  </script>
</body>
</html>
